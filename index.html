
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>룽지와 잔비의 토토</title>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/pretendard@1.3.8/dist/web/variable/pretendardvariable-dynamic-subset.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Gowun Dodum', sans-serif;
      background-color: #f0f8ff;
      color: #003f5c;
      padding: 30px;
    }
    h1 {
      font-size: 32px;
      margin-bottom: 20px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .balance-box {
      border: 2px solid #90caf9;
      border-radius: 12px;
      padding: 20px;
      background-color: #ffffff;
      margin-bottom: 20px;
      position: relative;
    }
    .edit-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      background-color: #4fc3f7;
      color: white;
      border: none;
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Pretendard', sans-serif;
    }
    .action-btn {
      background-color: #4fc3f7;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
      font-family: 'Pretendard', sans-serif;
    }
    canvas {
      margin-top: 30px;
      background-color: #ffffff;
      border-radius: 10px;
      padding: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #ffffff;
      font-family: 'Gowun Dodum', sans-serif;
    }
    th, td {
      border: 1px solid #90caf9;
      padding: 10px;
      text-align: center;
    }
    .delete-btn {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    a { text-decoration: none; color: inherit; }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>룽지와 잔비의 토토</h1>
    <button class="action-btn" onclick="location.href='game.html'">게임 시작</button>
  </div>

  <div class="balance-box">
    <h3>&lt;현재 자본금&gt;</h3>
    <p>룽지: <span id="moneyR">0</span> 원</p>
    <p>잔비: <span id="moneyZ">0</span> 원</p>
    <button class="edit-btn" onclick="location.href='edit.html'">수정</button>
  </div>

  <h3>현재 게임 승률 vs 누적 게임 승률</h3>
  <canvas id="chart" width="400" height="200"></canvas>

  <h3>게임 기록</h3>
  <table id="gameTable">
    <thead>
      <tr>
        <th>게임 번호</th><th>승자</th><th>룽지</th><th>잔비</th><th>미니게임</th><th>삭제</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const gameList = JSON.parse(localStorage.getItem("gameList") || "[]");
    const gameTable = document.querySelector("#gameTable tbody");

    const moneyR = parseInt(localStorage.getItem("moneyR") || "100000");
    const moneyZ = parseInt(localStorage.getItem("moneyZ") || "100000");
    document.getElementById("moneyR").innerText = moneyR.toLocaleString();
    document.getElementById("moneyZ").innerText = moneyZ.toLocaleString();

    gameList.forEach((g, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${g.winner}</td>
        <td>${g.moneyR.toLocaleString()}원</td>
        <td>${g.moneyZ.toLocaleString()}원</td>
        <td><a href="mini-game.html?gameId=${i + 1}">보기</a></td>
        <td><button class="delete-btn" onclick="deleteGame(${i})">삭제</button></td>
      `;
      gameTable.appendChild(tr);
    });

    function deleteGame(index) {
      if (!confirm("이 게임 기록을 삭제할까요?")) return;
      gameList.splice(index, 1);
      localStorage.setItem("gameList", JSON.stringify(gameList));
      location.reload();
    }

    const gameWinsR = gameList.filter(g => g.winner === "룽지").length;
    const gameWinsZ = gameList.filter(g => g.winner === "잔비").length;
    const totalGames = gameList.length;

    const miniWinsR = parseInt(localStorage.getItem("miniWinR") || "0");
    const miniWinsZ = parseInt(localStorage.getItem("miniWinZ") || "0");
    const miniTotal = parseInt(localStorage.getItem("miniTotal") || "0");

    const ctx = document.getElementById("chart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["룽지", "잔비"],
        datasets: [
          {
            label: "현재 게임 승률",
            data: [
              miniTotal ? (miniWinsR / miniTotal) * 100 : 0,
              miniTotal ? (miniWinsZ / miniTotal) * 100 : 0,
            ],
            backgroundColor: "#64b5f6"
          },
          {
            label: "누적 게임 승률",
            data: [
              totalGames ? (gameWinsR / totalGames) * 100 : 0,
              totalGames ? (gameWinsZ / totalGames) * 100 : 0,
            ],
            type: "line",
            borderColor: "#f06292",
            fill: false
          }
        ]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        }
      }
    });
  </script>
</body>
</html>
