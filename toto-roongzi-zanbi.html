<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>잔비끼리 토토 - 풀버전</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #e0f7fa;
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      color: #01579b;
      padding: 20px;
    }
    h1, h2, h3, h4 {
      color: #0288d1;
    }
    input, label {
      font-size: 16px;
      margin: 5px 0;
    }
    button {
      background-color: #4fc3f7;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }
    button:hover {
      background-color: #29b6f6;
    }
    input[type="text"], input[type="number"] {
      padding: 5px;
      border-radius: 6px;
      border: 1px solid #81d4fa;
      background-color: #ffffff;
      margin-bottom: 10px;
    }
    .record {
      background-color: #ffffff;
      border: 1px solid #81d4fa;
      padding: 10px;
      border-radius: 8px;
      margin-top: 20px;
    }
    #recordList li {
      margin-bottom: 5px;
    }
    #winChart {
      max-width: 500px;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>잔비끼리 토토</h1>

  <div>
    <label>경기 결과 (승리팀 이름): </label>
    <input type="text" id="resultTeam">
  </div>

  <div>
    <h3>내 배팅</h3>
    <label>내가 건 팀: </label>
    <input type="text" id="myTeam"><br>
    <label>건 금액: </label>
    <input type="number" id="myBet" value="0"><br>
    <label>배당률: </label>
    <input type="number" id="myOdds" value="2">
  </div>

  <div>
    <h3>잔비 배팅</h3>
    <label>잔비가 건 팀: </label>
    <input type="text" id="friendTeam"><br>
    <label>건 금액: </label>
    <input type="number" id="friendBet" value="0"><br>
    <label>배당률: </label>
    <input type="number" id="friendOdds" value="2">
  </div>

  <button onclick="checkResult()">결과 확인</button>

  <h2 id="myResult"></h2>
  <h2 id="friendResult"></h2>

  <h3>현재 소지금</h3>
  <p>룽지: <span id="myMoney">100000</span>원</p>
  <p>잔비: <span id="friendMoney">100000</span>원</p>

  <h3>현재 왕</h3>
  <p><span id="currentKing">없음</span></p>

  <h3>승률</h3>
  <p>너 승률: <span id="myWinRate">0%</span></p>
  <p>잔비 승률: <span id="friendWinRate">0%</span></p>

  <canvas id="winChart"></canvas>

  <hr>

  <h3>추가 기능</h3>
  <div>
    <h4>추가 돈 발급</h4>
    <label>너 동의함?</label>
    <input type="checkbox" id="myAgreeAdd">
    <label>잔비 동의함?</label>
    <input type="checkbox" id="friendAgreeAdd">
    <button onclick="addMoney()">추가 발급</button>
  </div>

  <div>
    <h4>게임 리셋</h4>
    <label>너 리셋 동의?</label>
    <input type="checkbox" id="myAgreeReset">
    <label>잔비 리셋 동의?</label>
    <input type="checkbox" id="friendAgreeReset">
    <button onclick="resetGame()">리셋</button>
  </div>

  <div class="record">
    <h3>경기 기록</h3>
    <ul id="recordList"></ul>
  </div>

  <script>
    let myMoney = 100000;
    let friendMoney = 100000;

    let totalGames = 0;
    let myWins = 0;
    let friendWins = 0;

    const winChart = new Chart(document.getElementById("winChart"), {
      type: "bar",
      data: {
        labels: ["너", "잔비"],
        datasets: [{
          label: "승리 횟수",
          data: [0, 0],
          backgroundColor: ["#4fc3f7", "#81d4fa"]
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    function checkResult() {
      const resultTeam = document.getElementById('resultTeam').value.trim();
      const myTeam = document.getElementById('myTeam').value.trim();
      const myBet = parseInt(document.getElementById('myBet').value);
      const myOdds = parseFloat(document.getElementById('myOdds').value);
      const friendTeam = document.getElementById('friendTeam').value.trim();
      const friendBet = parseInt(document.getElementById('friendBet').value);
      const friendOdds = parseFloat(document.getElementById('friendOdds').value);

      if (myBet > myMoney || friendBet > friendMoney) {
        alert("배팅 금액이 소지금보다 많아! 다시 입력해!");
        return;
      }

      let myResult = "", friendResult = "";
      if (resultTeam === myTeam) {
        const gain = myBet * myOdds;
        myMoney += gain;
        myResult = `너가 이겼어! +${gain}원`;
        myWins++;
      } else {
        myMoney -= myBet;
        myResult = `너가 졌어... -${myBet}원`;
      }

      if (resultTeam === friendTeam) {
        const gain = friendBet * friendOdds;
        friendMoney += gain;
        friendResult = `잔비가 이겼어! +${gain}원`;
        friendWins++;
      } else {
        friendMoney -= friendBet;
        friendResult = `잔비가 졌어... -${friendBet}원`;
      }

      totalGames++;
      updateDisplay(myResult, friendResult);
      addRecord(resultTeam, myTeam, myBet, friendTeam, friendBet);

      if (myMoney <= 0) alert("너 파산했어...");
      if (friendMoney <= 0) alert("잔비 파산했어...");
    }

    function updateDisplay(myResult, friendResult) {
      document.getElementById('myResult').innerText = myResult;
      document.getElementById('friendResult').innerText = friendResult;
      document.getElementById('myMoney').innerText = myMoney;
      document.getElementById('friendMoney').innerText = friendMoney;
      updateKing();
      updateWinRate();
    }

    function updateKing() {
      const king = (myMoney > friendMoney) ? "너!" : (friendMoney > myMoney) ? "잔비!" : "비겼어!";
      document.getElementById('currentKing').innerText = king;
    }

    function updateWinRate() {
      const myRate = totalGames ? ((myWins / totalGames) * 100).toFixed(1) : 0;
      const friendRate = totalGames ? ((friendWins / totalGames) * 100).toFixed(1) : 0;
      document.getElementById('myWinRate').innerText = myRate + "%";
      document.getElementById('friendWinRate').innerText = friendRate + "%";
      winChart.data.datasets[0].data = [myWins, friendWins];
      winChart.update();
    }

    function addRecord(resultTeam, myTeam, myBet, friendTeam, friendBet) {
      const recordList = document.getElementById('recordList');
      const li = document.createElement('li');
      li.textContent = `${totalGames}경기 - 승리팀: ${resultTeam}, 너: ${myTeam} (${myBet}원), 잔비: ${friendTeam} (${friendBet}원)`;
      recordList.appendChild(li);
    }

    function addMoney() {
      if (document.getElementById('myAgreeAdd').checked && document.getElementById('friendAgreeAdd').checked) {
        myMoney += 100000;
        friendMoney += 100000;
        alert("둘 다 동의했어! 10만원씩 추가 발급 완료!");
        updateDisplay("", "");
      } else {
        alert("둘 다 동의해야 추가 발급 가능해!");
      }
    }

    function resetGame() {
      if (document.getElementById('myAgreeReset').checked && document.getElementById('friendAgreeReset').checked) {
        myMoney = 100000;
        friendMoney = 100000;
        totalGames = myWins = friendWins = 0;
        document.getElementById('recordList').innerHTML = "";
        alert("둘 다 동의했어! 게임 리셋 완료!");
        updateDisplay("", "");
      } else {
        alert("둘 다 동의해야 리셋 가능해!");
      }
    }
  </script>
</body>
</html>
